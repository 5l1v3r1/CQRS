<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - doc-coverage.info - Ninject/Azure/Cqrs.Ninject.Azure.Wcf/Configuration/WebHostModule.cs</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">Documentation Coverage Report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">Ninject/Azure/Cqrs.Ninject.Azure.Wcf/Configuration</a> - WebHostModule.cs</td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Version:</td>
            <td class="headerValue">4.0</td>
            <td></td>
            <td class="headerItem">Artefacts:</td>
            <td class="headerCovTableEntry">7</td>
            <td class="headerCovTableEntry">7</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2019-12-26 19:57:08</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<span class="lineNum">       1 </span>            : ï»¿#region Copyright
<span class="lineNum">       2 </span>            : // // -----------------------------------------------------------------------
<span class="lineNum">       3 </span>            : // // &lt;copyright company=&quot;Chinchilla Software Limited&quot;&gt;
<span class="lineNum">       4 </span>            : // //   Copyright Chinchilla Software Limited. All rights reserved.
<span class="lineNum">       5 </span>            : // // &lt;/copyright&gt;
<span class="lineNum">       6 </span>            : // // -----------------------------------------------------------------------
<span class="lineNum">       7 </span>            : #endregion
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            : using System;
<span class="lineNum">      10 </span>            : using System.Linq;
<span class="lineNum">      11 </span>            : using Chinchilla.Logging;
<span class="lineNum">      12 </span>            : using Chinchilla.Logging.Azure.ApplicationInsights;
<span class="lineNum">      13 </span>            : using Chinchilla.Logging.Azure.Configuration;
<span class="lineNum">      14 </span>            : using Chinchilla.Logging.Configuration;
<span class="lineNum">      15 </span>            : using Chinchilla.StateManagement;
<span class="lineNum">      16 </span>            : using Chinchilla.StateManagement.Threaded;
<span class="lineNum">      17 </span>            : using Chinchilla.StateManagement.Web;
<span class="lineNum">      18 </span>            : using Cqrs.Authentication;
<span class="lineNum">      19 </span>            : using Cqrs.Azure.ConfigurationManager;
<span class="lineNum">      20 </span>            : using Cqrs.Configuration;
<span class="lineNum">      21 </span>            : using Cqrs.Ninject.Configuration;
<span class="lineNum">      22 </span>            : using Cqrs.Services;
<span class="lineNum">      23 </span>            : using Ninject.Modules;
<span class="lineNum">      24 </span>            : #if NET472
<span class="lineNum">      25 </span>            : using Ninject.Web.Common;
<span class="lineNum">      26 </span>            : using System.Web;
<span class="lineNum">      27 </span>            : #endif
<span class="lineNum">      28 </span>            : #if NETSTANDARD2_0
<span class="lineNum">      29 </span>            : using Microsoft.Extensions.Configuration;
<span class="lineNum">      30 </span>            : #endif
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            : namespace Cqrs.Ninject.Azure.Wcf.Configuration
<span class="lineNum">      33 </span>            : {
<span class="lineNum">      34 </span>            :         /// &lt;summary&gt;
<span class="lineNum">      35 </span>            :         /// The core &lt;see cref=&quot;INinjectModule&quot;/&gt; for use defining base level requirements.
<span class="lineNum">      36 </span>            :         /// &lt;/summary&gt;
<span class="lineNum">      37 </span>            :         public class WebHostModule : ResolvableModule
<span class="lineNum">      38 </span><span class="lineCov">          1 :         {</span>
<span class="lineNum">      39 </span>            : #if NETSTANDARD2_0
<span class="lineNum">      40 </span>            :                 /// &lt;summary&gt;
<span class="lineNum">      41 </span>            :                 /// Gets or sets the &lt;see cref=&quot;IConfigurationManager&quot;/&gt;. This must be set manually as dependency injection may not be ready in-time.
<span class="lineNum">      42 </span>            :                 /// &lt;/summary&gt;
<span class="lineNum">      43 </span>            :                 public static IConfiguration Configuration { get; set; }
<span class="lineNum">      44 </span>            : #endif
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            :                 #region Overrides of NinjectModule
<span class="lineNum">      47 </span>            : 
<span class="lineNum">      48 </span>            :                 /// &lt;summary&gt;
<span class="lineNum">      49 </span>            :                 /// Loads the module into the kernel.
<span class="lineNum">      50 </span>            :                 /// &lt;/summary&gt;
<span class="lineNum">      51 </span><span class="lineCov">          1 :                 public override void Load()</span>
<span class="lineNum">      52 </span>            :                 {
<span class="lineNum">      53 </span>            :                         RegisterBasicHelpers();
<span class="lineNum">      54 </span>            :                         RegisterAzureConfigurations();
<span class="lineNum">      55 </span>            :                         RegisterBasicSerives();
<span class="lineNum">      56 </span>            :                         RegisterWebBit();
<span class="lineNum">      57 </span>            :                 }
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            : #endregion
<span class="lineNum">      60 </span>            : 
<span class="lineNum">      61 </span>            :                 /// &lt;summary&gt;
<span class="lineNum">      62 </span>            :                 /// Register the all Azure configurations
<span class="lineNum">      63 </span>            :                 /// &lt;/summary&gt;
<span class="lineNum">      64 </span><span class="lineCov">          1 :                 protected virtual void RegisterAzureConfigurations()</span>
<span class="lineNum">      65 </span>            :                 {
<span class="lineNum">      66 </span>            :                         Bind&lt;ILoggerSettings&gt;()
<span class="lineNum">      67 </span>            :                                 .To&lt;AzureLoggerSettingsConfiguration&gt;()
<span class="lineNum">      68 </span>            :                                 .InSingletonScope();
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span>            : #if NETSTANDARD2_0
<span class="lineNum">      71 </span>            :                         Bind&lt;IConfiguration&gt;()
<span class="lineNum">      72 </span>            :                                 .ToConstant(Configuration)
<span class="lineNum">      73 </span>            :                                 .InSingletonScope();
<span class="lineNum">      74 </span>            : #endif
<span class="lineNum">      75 </span>            : 
<span class="lineNum">      76 </span>            :                         Bind&lt;IConfigurationManager&gt;()
<span class="lineNum">      77 </span>            :                                 .To&lt;CloudConfigurationManager&gt;()
<span class="lineNum">      78 </span>            :                                 .InSingletonScope();
<span class="lineNum">      79 </span>            :                 }
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span>            :                 /// &lt;summary&gt;
<span class="lineNum">      82 </span>            :                 /// Registers the basic helpers required.
<span class="lineNum">      83 </span>            :                 /// &lt;/summary&gt;
<span class="lineNum">      84 </span><span class="lineCov">          1 :                 protected virtual void RegisterBasicHelpers()</span>
<span class="lineNum">      85 </span>            :                 {
<span class="lineNum">      86 </span>            :                         RegisterContextItemCollectionFactory();
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            :                         Bind&lt;ITelemetryHelper&gt;()
<span class="lineNum">      89 </span>            :                                 .To&lt;TelemetryHelper&gt;()
<span class="lineNum">      90 </span>            :                                 .InSingletonScope();
<span class="lineNum">      91 </span>            :                 }
<span class="lineNum">      92 </span>            :                 /// &lt;summary&gt;
<span class="lineNum">      93 </span>            :                 /// Registers the &lt;see cref=&quot;IContextItemCollectionFactory&quot;/&gt; required.
<span class="lineNum">      94 </span>            :                 /// &lt;/summary&gt;
<span class="lineNum">      95 </span><span class="lineCov">          1 :                 protected virtual void RegisterContextItemCollectionFactory()</span>
<span class="lineNum">      96 </span>            :                 {
<span class="lineNum">      97 </span>            :                         var configurationManager = Resolve&lt;IConfigurationManager&gt;();
<span class="lineNum">      98 </span>            :                         if (!configurationManager.TryGetSetting(&quot;Cqrs.SetupForWeb&quot;, out bool setupForWeb))
<span class="lineNum">      99 </span>            :                                 setupForWeb = true;
<span class="lineNum">     100 </span>            : 
<span class="lineNum">     101 </span>            :                         // We use console state for WebJobs as, even though a webjob runs in an azure website, it's technically loaded via something call the 'WindowsScriptHost', which is not web and IIS based so it's threading model is very different and more console based.
<span class="lineNum">     102 </span>            :                         if (Kernel.GetBindings(typeof(IContextItemCollectionFactory)).Any())
<span class="lineNum">     103 </span>            :                                 Kernel.Unbind&lt;IContextItemCollectionFactory&gt;();
<span class="lineNum">     104 </span>            :                         if (Kernel.GetBindings(typeof(IContextItemCollection)).Any())
<span class="lineNum">     105 </span>            :                                 Kernel.Unbind&lt;IContextItemCollection&gt;();
<span class="lineNum">     106 </span>            :                         if (setupForWeb)
<span class="lineNum">     107 </span>            :                         {
<span class="lineNum">     108 </span>            :                                 Bind&lt;IContextItemCollectionFactory&gt;()
<span class="lineNum">     109 </span>            :                                         .To&lt;WebContextItemCollectionFactory&gt;()
<span class="lineNum">     110 </span>            :                                         .InSingletonScope();
<span class="lineNum">     111 </span>            :                                 Bind&lt;IContextItemCollection&gt;()
<span class="lineNum">     112 </span>            :                                         .To&lt;WebContextItemCollection&gt;()
<span class="lineNum">     113 </span>            :                                         .InSingletonScope();
<span class="lineNum">     114 </span>            :                         }
<span class="lineNum">     115 </span>            :                         else
<span class="lineNum">     116 </span>            :                         {
<span class="lineNum">     117 </span>            :                                 Bind&lt;IContextItemCollectionFactory&gt;()
<span class="lineNum">     118 </span>            :                                         .To&lt;ContextItemCollectionFactory&gt;()
<span class="lineNum">     119 </span>            :                                         .InSingletonScope();
<span class="lineNum">     120 </span>            :                                 Bind&lt;IContextItemCollection&gt;()
<span class="lineNum">     121 </span>            :                                         .To&lt;Chinchilla.StateManagement.Threaded.ContextItemCollection&gt;()
<span class="lineNum">     122 </span>            :                                         .InSingletonScope();
<span class="lineNum">     123 </span>            :                         }
<span class="lineNum">     124 </span>            :                 }
<span class="lineNum">     125 </span>            : 
<span class="lineNum">     126 </span>            :                 /// &lt;summary&gt;
<span class="lineNum">     127 </span>            :                 /// Registers the basic services required.
<span class="lineNum">     128 </span>            :                 /// &lt;/summary&gt;
<span class="lineNum">     129 </span><span class="lineCov">          1 :                 protected virtual void RegisterBasicSerives()</span>
<span class="lineNum">     130 </span>            :                 {
<span class="lineNum">     131 </span>            :                         string authenticationType;
<span class="lineNum">     132 </span>            :                         if (!Resolve&lt;IConfigurationManager&gt;().TryGetSetting(&quot;Cqrs.AuthenticationTokenType&quot;, out authenticationType))
<span class="lineNum">     133 </span>            :                                 authenticationType = &quot;Guid&quot;;
<span class="lineNum">     134 </span>            : 
<span class="lineNum">     135 </span>            :                         if (authenticationType.ToLowerInvariant() == &quot;int&quot; || authenticationType.ToLowerInvariant() == &quot;integer&quot;)
<span class="lineNum">     136 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     137 </span>            :                                         .To&lt;UnitOfWorkService&lt;int&gt;&gt;()
<span class="lineNum">     138 </span>            :                                         .InThreadScope();
<span class="lineNum">     139 </span>            :                         else if (authenticationType.ToLowerInvariant() == &quot;guid&quot;)
<span class="lineNum">     140 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     141 </span>            :                                         .To&lt;UnitOfWorkService&lt;Guid&gt;&gt;()
<span class="lineNum">     142 </span>            :                                         .InThreadScope();
<span class="lineNum">     143 </span>            :                         else if (authenticationType.ToLowerInvariant() == &quot;string&quot; || authenticationType.ToLowerInvariant() == &quot;text&quot;)
<span class="lineNum">     144 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     145 </span>            :                                         .To&lt;UnitOfWorkService&lt;string&gt;&gt;()
<span class="lineNum">     146 </span>            :                                         .InThreadScope();
<span class="lineNum">     147 </span>            : 
<span class="lineNum">     148 </span>            :                         else if (authenticationType == &quot;SingleSignOnToken&quot;)
<span class="lineNum">     149 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     150 </span>            :                                         .To&lt;UnitOfWorkService&lt;SingleSignOnToken&gt;&gt;()
<span class="lineNum">     151 </span>            :                                         .InThreadScope();
<span class="lineNum">     152 </span>            :                         else if (authenticationType == &quot;SingleSignOnTokenWithUserRsn&quot;)
<span class="lineNum">     153 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     154 </span>            :                                         .To&lt;UnitOfWorkService&lt;SingleSignOnTokenWithUserRsn&gt;&gt;()
<span class="lineNum">     155 </span>            :                                         .InThreadScope();
<span class="lineNum">     156 </span>            :                         else if (authenticationType == &quot;SingleSignOnTokenWithCompanyRsn&quot;)
<span class="lineNum">     157 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     158 </span>            :                                         .To&lt;UnitOfWorkService&lt;SingleSignOnTokenWithCompanyRsn&gt;&gt;()
<span class="lineNum">     159 </span>            :                                         .InThreadScope();
<span class="lineNum">     160 </span>            :                         else if (authenticationType == &quot;SingleSignOnTokenWithUserRsnAndCompanyRsn&quot;)
<span class="lineNum">     161 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     162 </span>            :                                         .To&lt;UnitOfWorkService&lt;SingleSignOnTokenWithUserRsnAndCompanyRsn&gt;&gt;()
<span class="lineNum">     163 </span>            :                                         .InThreadScope();
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span>            :                         else if (authenticationType == &quot;ISingleSignOnToken&quot;)
<span class="lineNum">     166 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     167 </span>            :                                         .To&lt;UnitOfWorkService&lt;ISingleSignOnToken&gt;&gt;()
<span class="lineNum">     168 </span>            :                                         .InThreadScope();
<span class="lineNum">     169 </span>            :                         else if (authenticationType == &quot;ISingleSignOnTokenWithUserRsn&quot;)
<span class="lineNum">     170 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     171 </span>            :                                         .To&lt;UnitOfWorkService&lt;ISingleSignOnTokenWithUserRsn&gt;&gt;()
<span class="lineNum">     172 </span>            :                                         .InThreadScope();
<span class="lineNum">     173 </span>            :                         else if (authenticationType == &quot;ISingleSignOnTokenWithCompanyRsn&quot;)
<span class="lineNum">     174 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     175 </span>            :                                         .To&lt;UnitOfWorkService&lt;ISingleSignOnTokenWithCompanyRsn&gt;&gt;()
<span class="lineNum">     176 </span>            :                                         .InThreadScope();
<span class="lineNum">     177 </span>            :                         else if (authenticationType == &quot;ISingleSignOnTokenWithUserRsnAndCompanyRsn&quot;)
<span class="lineNum">     178 </span>            :                                 Bind&lt;IUnitOfWorkService&gt;()
<span class="lineNum">     179 </span>            :                                         .To&lt;UnitOfWorkService&lt;ISingleSignOnTokenWithUserRsnAndCompanyRsn&gt;&gt;()
<span class="lineNum">     180 </span>            :                                         .InThreadScope();
<span class="lineNum">     181 </span>            :                 }
<span class="lineNum">     182 </span>            : 
<span class="lineNum">     183 </span>            :                 /// &lt;summary&gt;
<span class="lineNum">     184 </span>            :                 /// Registers some things Ninject likes.
<span class="lineNum">     185 </span>            :                 /// &lt;/summary&gt;
<span class="lineNum">     186 </span><span class="lineCov">          1 :                 protected virtual void RegisterWebBit()</span>
<span class="lineNum">     187 </span>            :                 {
<span class="lineNum">     188 </span>            : #if NET472
<span class="lineNum">     189 </span>            :                         Bind&lt;Func&lt;IKernel&gt;&gt;().ToMethod(ctx =&gt; () =&gt; new Bootstrapper().Kernel);
<span class="lineNum">     190 </span>            :                         Bind&lt;IHttpModule&gt;().To&lt;HttpApplicationInitializationHttpModule&gt;();
<span class="lineNum">     191 </span>            : #endif
<span class="lineNum">     192 </span>            :                 }
<span class="lineNum">     193 </span>            :         }
<span class="lineNum">     194 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
